import express, { Request, Response, Router } from 'express';
import { conn } from './connection';

const router = Router();

//????????????????????????????????????????????????????????????????? configuracoes
router.use(express.urlencoded({
  extended: true
}));
router.use(express.json());
//????????????????????????????????????????????????????????????????? configuracoes

router.get('/', (req: Request, res: Response) => {
  res.render('home');
});

//! SELECT
router.get('/books', (req: Request, res: Response) => {
  const query = `SELECT * FROM books`;

  conn.query(query, (err, data) => {
    if (err) {
      console.log(err);
      return;
    }

    const books = data;

    //console.log(books);
    res.render('books', { books });
  });
});

//! INSERT
router.post('/books/insertbook', (req: Request, res: Response) => {
  const title = req.body.title;
  const pageqty = req.body.pageqty;

  const query = `INSERT INTO books (title, pageqty) VALUES ('${title}', ${pageqty})`;

  conn.query(query, err => {
    if (err) {
      console.log(err);
    }

    res.redirect('/books');
  });
});

export default router;